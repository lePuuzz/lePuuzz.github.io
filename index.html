<!DOCTYPE html>
<html>
    <head>
        <style>
            .dark-mode {
                background-color: #121212;
                color: white;
            }
            
            .dark-mode textarea, .dark-mode button, .dark-mode input[type="button"], .dark-mode input[type="number"], .dark-mode span {
                background-color: #121212;
                color: #ddd;
            }
            
            button {
                background-color: #4A90E2;
                color: white;
                border-radius: 5px;
                border: none;
                padding: 5px 10px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin-top:10px;
                cursor:pointer;
            }
            
            body {
                font-family:'Arial', sans-serif;
                color:#4A4A4A;
            }

            #startPage {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                text-align: center;
            }

            #imageContainer {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
}

        </style>
        
    </head>
<body style="zoom: 110%; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0;">
    <div id="startPage">
        <h1>Willkommen auf unserer Webseite!</h1>
        <p>Bitte laden Sie ein Bild hoch, um fortzufahren.</p>
        <button id="uploadButton" onclick="document.getElementById('imageUpload').click();" style="margin-bottom: 10px;">Datei auswählen</button>
        <button id="toggleDarkModeButton">Dark Mode</button>
    </div>    
    <div id="imageContainer" style="flex: 1 1 auto; min-width: 500px; flex-direction: column;">
        <div id="uploadAndAnalyzeSection" style="display: flex; justify-content: space-around; align-items: center;">
            <input type="file" id="imageUpload" style="display: none;" onchange="updateFileName(); showElements();" />
            <button id="uploadButton" onclick="document.getElementById('imageUpload').click();" style="margin-bottom: 10px;">Datei auswählen</button>
            <span id="fileName"></span>
            <input type="number" id="length" placeholder="Länge in cm" />
            <button id="analyzeButton" onclick="analyzeImage()">Analyze</button>
        </div>
        <div style="position: relative; width: 100%; max-height: 600px; max-width: 1000px;">
            <img id="preview" style="max-width: 100%; max-height: 600px; object-fit: contain;" onload="adjustLayout()" />
            <canvas id="overlay" style="position: absolute; top: 0; left: 0; pointer-events: none; max-width: 100%; max-height: 600px; display: none;"></canvas>
        </div>
        <div id="buttonSection" style="display: flex; justify-content: space-around; align-items: center;">
            <button id="toggleOverlayButton">Toggle Overlay</button>
            <button id="toggleDarkModeButton">Dark Mode</button>
        </div>
    </div>
    <div id="resultsContainer" style="flex: 1 1 auto; min-width: 250px; margin-left: 20px;">
        <textarea id="results" style="width: 100%; height: 300px; resize: none; border: none;" readonly></textarea>
    </div>
    
    

<script>
// Defining the colors
const colors = {
    'rot': [255, 0, 0],
    'gelb': [255, 255, 0],
    'schwarz': [0, 0, 0],
    'grün': [0, 128, 0],
    'lila': [128, 0, 128],
    'rosa': [255, 192, 203],
    'orange': [255, 165, 0],
    'blau': [0, 0, 255],
    'türkis': [64,224,208], // Neu hinzugefügt
    'dunkelrot': [139,0,0], // Dunkelrot
    'hellgrün': [144,238,144], // Hellgrün
    'braun': [165,42,42], // Neu hinzugefügt
    'beige': [245,245,220] // Neu hinzugefügt
};

function showElements() {
    document.getElementById('startPage').style.display = 'none';
    document.getElementById('imageContainer').style.display = 'flex';
    const elements = document.querySelectorAll('#imageContainer > *');
    for (let i = 0; i < elements.length; i++) {
        if (elements[i].id !== 'uploadButton') {
            elements[i].style.display = 'block';
        }
    }
}

window.onload = function() {
    const elements = document.querySelectorAll('#imageContainer > *');
    for (let i = 0; i < elements.length; i++) {
        if (elements[i].id !== 'uploadButton') {
            elements[i].style.display = 'none';
        }
    }
}

// Function to find the closest color
function closestColor(rgb) {
    let colorDiff = Infinity;
    let closestColor;
    for (let color in colors) {
        const diff = Math.abs(rgb[0] - colors[color][0]) + Math.abs(rgb[1] - colors[color][1]) + Math.abs(rgb[2] - colors[color][2]);
        if (diff < colorDiff) {
            colorDiff = diff;
            closestColor = color;
        }
    }
    return closestColor;
}

// Function to analyze the image
function analyzeImage() {
        const fileInput = document.getElementById('imageUpload');
        const lengthInput = document.getElementById('length');
        const file = fileInput.files[0];
        const lengthInCm = lengthInput.value;

        // Check if file and length are provided
        if (!file || !lengthInCm) {
            alert('Please select a file and enter the length.');
            return;
        }

        const img = new Image();
        img.src = URL.createObjectURL(file);

        img.onload = function() {
            // Show a preview of the image
            document.getElementById('preview').src = img.src;

            const canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

            const overlayCtx = document.getElementById('overlay').getContext('2d');
            overlayCtx.canvas.width = img.width;
            overlayCtx.canvas.height = img.height;

const overlayImageData = overlayCtx.createImageData(canvas.width, canvas.height);

            const colorCounts = {};

            for (let i = 0; i < imageData.data.length; i += 4) {
                const r = imageData.data[i];
                const g = imageData.data[i+1];
                const b = imageData.data[i+2];

                const colorName = closestColor([r,g,b]);
                colorCounts[colorName] = (colorCounts[colorName] || 0) + 1;

                // Set overlay pixel to the closest color
                overlayImageData.data[i]   = colors[colorName][0]; // Red
                overlayImageData.data[i+1] = colors[colorName][1]; // Green
                overlayImageData.data[i+2] = colors[colorName][2]; // Blue
                overlayImageData.data[i+3] = 127; // Alpha (transparency)
            }

            // Draw the overlay image data to the overlay canvas
            overlayCtx.putImageData(overlayImageData, 0, 0);

            let totalPixels = canvas.width * canvas.height;
            let resultsText = '';
for (let color in colorCounts) {
                let percentageOfImage = colorCounts[color] / totalPixels;
                let areaInSquareMeters;

                let widthInMeters = lengthInCm / 100.0;
                let heightInMeters = widthInMeters * (canvas.height / canvas.width);

                areaInSquareMeters = percentageOfImage * widthInMeters * heightInMeters;

                // Nur Farben auflisten, die mehr als 0,1 Quadratmeter des Bildes einnehmen
                if (areaInSquareMeters > 0.1) {
                    resultsText += `${color}: ${areaInSquareMeters.toFixed(2)} Quadratmeter\n`;
                }
            }

            document.getElementById('results').value = resultsText;

            // Position des Ausgabefelds anpassen
            adjustLayout();
        };
}

document.getElementById('analyzeButton').addEventListener('click', analyzeImage);

// Function to toggle the overlay
function toggleOverlay() {
    const overlay = document.getElementById('overlay');
    const button = document.getElementById('toggleOverlayButton');
    if (overlay.style.display === 'none') {
        overlay.style.display = 'block';
        button.style.backgroundColor = '#4CAF50'; // Green
    } else {
        overlay.style.display = 'none';
        button.style.backgroundColor = ''; // Default
    }
}

document.getElementById('toggleOverlayButton').addEventListener('click', toggleOverlay);

// Function to toggle the dark mode
function toggleDarkMode() {
   var element = document.body; 
   var button = document.getElementById('toggleDarkModeButton');
   element.classList.toggle("dark-mode");
   if (element.classList.contains("dark-mode")) {
       document.body.style.backgroundColor = "#121212";
       document.body.style.color = "white";
       button.style.backgroundColor = '#4CAF50'; // Green
   } else {
       document.body.style.backgroundColor = "white";
       document.body.style.color = "#121212";
       button.style.backgroundColor = ''; // Default
   }
}

document.getElementById('toggleDarkModeButton').addEventListener('click', toggleDarkMode);
</script>

<style>
    .dark-mode {
       background-color: #121212;
       color: white;
    }
    
    .dark-mode textarea, .dark-mode button, .dark-mode input {
       background-color: #121212;
       color: #ddd;
    }
    .dark-mode button, .dark-mode input[type="button"], .dark-mode input[type="number"], .dark-mode span {
   background-color: #121212;
   color: #ddd;
}

    
@media (min-height: 800px) {
  #resultsContainer {
    margin-left: 30px;}}
</style>


</body>
</html>
